<?xml version="1.0" encoding="UTF-8"?>

<!-- [y] hybris Platform Copyright (c) 2000-2014 hybris AG All rights reserved. This software is the confidential and proprietary information of hybris ("Confidential Information"). You shall not disclose such Confidential Information and shall use it only in accordance with the terms of the license agreement you entered into with hybris. -->

-<beans xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd http://www.springframework.org/schema/integration/file http://www.springframework.org/schema/integration/file/spring-integration-file.xsd" xmlns:p="http://www.springframework.org/schema/p" xmlns:file="http://www.springframework.org/schema/integration/file" xmlns:int="http://www.springframework.org/schema/integration" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.springframework.org/schema/beans">

<!-- General setup -->



-<bean class="de.hybris.platform.acceleratorservices.dataimport.batch.FileOrderComparator" id="fileOrderComparator">


-<property name="prefixPriority">


-<map>

<!-- default priority is 0 -->


<entry value="1" key="mpljewelleryprice"/>

<entry value="2" key="mplassociation"/>

<entry value="3" key="weight_variant_seller"/>

</map>

</property>

</bean>


-<bean class="java.lang.String" id="baseDirectoryMarketplaceJewelleryPrice">

<constructor-arg value="#{baseDirectory}/${tenantId}/marketplace-jewelleryprice"/>

</bean>

<!-- 1) Scan for files -->



-<file:inbound-channel-adapter id="batchFilesMarketplaceJewelleryPrice" auto-startup="#{configurationService.configuration.getProperty('etail.batch.import.hotfolder.enabled')}" comparator="fileOrderComparator" filename-regex="^(.*)-(\d+)\.csv" directory="#{baseDirectoryMarketplaceJewelleryPrice}">

<int:poller fixed-rate="1000"/>

</file:inbound-channel-adapter>

<!-- 2) move the file to processing and setup header -->


<file:outbound-gateway directory="#{baseDirectoryMarketplaceJewelleryPrice}/processing" delete-source-files="true" reply-channel="batchFilesMarketplaceJewelleryPriceProc" request-channel="batchFilesMarketplaceJewelleryPrice"/>

<!-- 3) transform csv to impex file -->


<int:service-activator method="execute" ref="batchTransformerTask" output-channel="batchFilesTran" input-channel="batchFilesHeader"/>


-<bean class="de.hybris.platform.acceleratorservices.dataimport.batch.task.ImpexTransformerTask" id="batchTransformerTask" init-method="initConvertersMap">

<property name="fieldSeparator" value=","/>

<property name="encoding" value="UTF-8"/>

<property name="linesToSkip" value="0"/>

<property name="cleanupHelper" ref="cleanupHelper"/>

</bean>

<int:service-activator method="execute" ref="MarketplacePriceHeaderSetupTask" output-channel="batchFilesHeaderInit" input-channel="batchFilesMarketplaceJewelleryPriceProc"/>


-<bean class="de.hybris.platform.acceleratorservices.dataimport.batch.task.HeaderSetupTask" id="MarketplacePriceHeaderSetupTask">

<property name="catalog" value="mplProductCatalog"/>

<property name="net" value="false"/>

<property name="storeBaseDirectory" ref="baseDirectoryMarketplaceJewelleryPrice"/>

</bean>

<!-- Transformer converters mappings -->


<!-- Transformer for Price Import -->


<bean class="de.hybris.platform.acceleratorservices.dataimport.batch.converter.mapping.impl.DefaultConverterMapping" id="batchMplpriceJewelleryConverterMapping" p:converter-ref="batchMplpriceJewelleryConverter" p:mapping="mpljewelleryprice"/>

<!-- Transformer for Product Approval when price is given Import -->


<bean class="de.hybris.platform.acceleratorservices.dataimport.batch.converter.mapping.impl.DefaultConverterMapping" id="batchMplprice_jewellery_product_approvalConverterMapping" p:converter-ref="batchMplprice_jewellery_product_approvalConverter" p:mapping="mpljewelleryprice"/>

<!-- Transformer for JewelleryPriceRow Import -->


<bean class="de.hybris.platform.acceleratorservices.dataimport.batch.converter.mapping.impl.DefaultConverterMapping" id="batchJewelleryConverterMapping" p:converter-ref="batchJewelleryConverter" p:mapping="mpljewelleryprice"/>

<!-- Transformer for Product Approval when price is given Import -->


<bean class="de.hybris.platform.acceleratorservices.dataimport.batch.converter.mapping.impl.DefaultConverterMapping" id="batchJewelleryHomedeliveryConverterMapping" p:converter-ref="batchJewelleryHomedeliveryConverter" p:mapping="mpljewelleryprice"/>

<!-- Transformer for Association Import -->


<bean class="de.hybris.platform.acceleratorservices.dataimport.batch.converter.mapping.impl.DefaultConverterMapping" id="batchMplAssociationConverterMapping" p:converter-ref="batchMplAssociationConverter" p:mapping="mplassociation"/>

<bean class="de.hybris.platform.acceleratorservices.dataimport.batch.converter.mapping.impl.DefaultConverterMapping" id="batchMplLeadAssociationConverterMapping" p:converter-ref="batchLeadUssidMplAssociationConverter" p:mapping="weight_variant_seller"/>

<!-- Converters -->


<!-- Converter for Price Import -->



-<bean class="com.tisl.mpl.dataimport.batch.converter.impl.ExtDefaultImpexConverter" id="batchMplpriceJewelleryConverter">


-<property name="header">

<value>#{defaultImpexProductHeader} $productCatalog=mplProductCatalog $catalogVersion=catalogversion(catalog(id[default=$productCatalog]),version[default='Online'])[unique=true,default='$productCatalog:Staged'] $taxGroup=Europe1PriceFactory_PTG(code)[default=jp-vat-full] # Set product approval status to Approved only for those products that have prices. $approved=approvalstatus(code)[default='approved'] $unit=unit(code[unique=true,default=pieces]) $currency=currency(isocode)[unique=true][default=INR] $minqtd=minqtd[default=1] $unitFactor=unitFactor[default=1] $net=net[default=false] INSERT_UPDATE PriceRow;product(code,$catalogVersion)[unique=true];sellerArticleSKU[unique=true][mode=append];price[translator=de.hybris.platform.acceleratorservices.dataimport.batch.converter.PriceTranslator];mrp;$unit;$currency;$minqtd;$unitFactor;$net </value>

</property>


-<property name="impexRow">

<value>;{+0};{+1};{+2};{+3}</value>

</property>

</bean>

<!-- Converter for Product Approval when price is given Import -->



-<bean class="de.hybris.platform.acceleratorservices.dataimport.batch.converter.impl.DefaultImpexConverter" id="batchMplprice_jewellery_product_approvalConverter">


-<property name="header">

<value>#{defaultImpexProductHeader} $productCatalog=mplProductCatalog $catalogVersion=catalogversion(catalog(id[default=$productCatalog]),version[default='Online'])[unique=true,default='$productCatalog:Staged'] $taxGroup=Europe1PriceFactory_PTG(code)[default=jp-vat-full] # Set product approval status to Approved only for those products that have prices. $approved=approvalstatus(code)[default='approved'] UPDATE Product;code[unique=true];$approved;$catalogVersion;$taxGroup </value>

</property>


-<property name="impexRow">

<value>;{+0}</value>

</property>


-<property name="rowFilter">


-<bean class="de.hybris.platform.acceleratorservices.dataimport.batch.converter.impl.DefaultImpexRowFilter">

<!--Row Filter to check Price Greater than 0 -->


<property name="expression" value="Double.valueOf(row[2]) >= 0"/>

</bean>

</property>

</bean>

<!-- Converter for Product Approval when price is given Import -->



-<bean class="de.hybris.platform.acceleratorservices.dataimport.batch.converter.impl.DefaultImpexConverter" id="batchJewelleryHomedeliveryConverter">


-<property name="header">

<value>#{defaultImpexProductHeader} $productCatalog=mplProductCatalog $catalogVersion=catalogversion(catalog(id[default=$productCatalog]),version[default='Online'])[unique=true,default='$productCatalog:Online'] $taxGroup=Europe1PriceFactory_PTG(code)[default=jp-vat-full] # Set product approval status to Approved only for those products that have prices. $approved=approvalstatus(code)[default='approved'] $inCurrency=INR $value=value[default='0.0'] $homedelivery=deliveryMode(code)[unique=true][default='home-delivery'] $zone=zone(code)[default='in'] $currency=currency(isocode)[default=$inCurrency] $minimum=minimum[default='0.0'] $deliveryFulfillModes=deliveryFulfillModes(Code)[default='sship'] INSERT_UPDATE MplZoneDeliveryModeValue;$value;sellerArticleSKU[unique=true](sellerArticleSKU,$catalogVersion);productCode[unique=true](code,$catalogVersion);$homedelivery;$zone;$currency;$minimum;$deliveryFulfillModes </value>

</property>


-<property name="impexRow">

<value>;{4};{+1};{+0};home-delivery ;{5};{+1};{+0};express-delivery ;{6};{+1};{+0};click-and-collect </value>

</property>

<!-- <property name="rowFilter"> <bean class="de.hybris.platform.acceleratorservices.dataimport.batch.converter.impl.DefaultImpexRowFilter"> Row Filter to check Price Greater than 0 <property name="expression" value="Double.valueOf(row[4]) > 0"/> </bean> </property> -->


</bean>

<!-- Converter for Product Approval when price is given Import -->



-<bean class="de.hybris.platform.acceleratorservices.dataimport.batch.converter.impl.DefaultImpexConverter" id="batchJewelleryConverter">


-<property name="header">

<value>#{defaultImpexProductHeader} $productCatalog=mplProductCatalog $catalogVersion=catalogversion(catalog(id[default=$productCatalog]),version[default='Online'])[unique=true,default='$productCatalog:Staged'] $taxGroup=Europe1PriceFactory_PTG(code)[default=jp-vat-full] # Set product approval status to Approved only for those products that have prices. $approved=approvalstatus(code)[default='approved'] INSERT_UPDATE JewelleryPriceRow;ProductCode;Ussid[unique=true];makingCharges;wastageCharges;goldRate;goldValue;silverRate;silverValue;platinumRate;platinumValue;solitaireRate;solitaireValue;totalDiamondValue;diamondRateType1;diamondValueType1;diamondRateType2;diamondValueType2;diamondRateType3;diamondValueType3;diamondRateType4;diamondValueType4;diamondRateType5;diamondValueType5;diamondRateType6;diamondValueType6;diamondRateType7;diamondValueType7;totalStoneValue;stoneRateType1;stoneValueType1;stoneRateType2;stoneValueType2;stoneRateType3;stoneValueType3;stoneRateType4;stoneValueType4;stoneRateType5;stoneValueType5;stoneRateType6;stoneValueType6;stoneRateType7;stoneValueType7;stoneRateType8;stoneValueType8;stoneRateType9;stoneValueType9;stoneRateType10;stoneValueType10; </value>

</property>


-<property name="impexRow">

<value>;{+0};{+1};{7};{8};{9};{10};{11};{12};{13};{14};{15};{16};{17};{18};{19};{20};{21};{22};{23};{24};{25};{26};{27};{28};{29};{30};{31};{32};{33};{34};{35};{36};{37};{38};{39};{40};{41};{42};{43};{44};{45};{46};{47};{48};{49};{50};{51};{52}</value>

</property>

</bean>


-<bean class="de.hybris.platform.acceleratorservices.dataimport.batch.converter.impl.DefaultImpexConverter" id="batchMplAssociationConverter">


-<property name="header">

<value>#{defaultImpexProductHeader} $productCatalog=mplProductCatalog $productCatalogName=Marketplace Product Catalog $catalogVersion=catalogversion(catalog(id[default=$productCatalog]),version[default='Online'])[unique=true,default=$productCatalog:Staged] $approved=approvalstatus(code)[default='approved'] INSERT_UPDATE JewelleryInformation;ProductCode;PCMUSSID;USSID[unique=true];PIMAttributeId[unique=true];Weight </value>

</property>


-<property name="impexRow">

<value>;{0};{1};{2};{3};{4}</value>

</property>

</bean>


-<bean class="com.tisl.mpl.dataimport.batch.converter.impl.AssociationLeadUssidConverter" id="batchLeadUssidMplAssociationConverter">


-<property name="header">

<value>#{defaultImpexProductHeader} $productCatalog=mplProductCatalog $productCatalogName=Marketplace Product Catalog $catalogVersion=catalogversion(catalog(id[default=$productCatalog]),version[default='Online'])[unique=true,default=$productCatalog:Staged] $approved=approvalstatus(code)[default='approved'] INSERT_UPDATE JewelleryInformation;ProductCode;PCMUSSID;USSID[unique=true];PIMAttributeId[unique=true];Weight </value>

</property>


-<property name="impexRow">

<value> ;{0};{1};{1};grossweightfinejwlry;{2} ;{0};{1};{1};metalweightfinejwlry;{3} ;{0};{1};{1};coinbarweightfinejwlry;{4} ;{0};{1};{1};solitaireweightfinejwlry;{5} ;{0};{1};{1};diamondtotalweightfinejwlry;{6} ;{0};{1};{1};diamondweightfinejwlry1;{7} ;{0};{1};{1};diamondweightfinejwlry2;{8} ;{0};{1};{1};diamondweightfinejwlry3;{9} ;{0};{1};{1};diamondweightfinejwlry4;{10} ;{0};{1};{1};diamondweightfinejwlry5;{11} ;{0};{1};{1};diamondweightfinejwlry6;{12} ;{0};{1};{1};diamondweightfinejwlry7;{13} </value>

</property>

</bean>

</beans>